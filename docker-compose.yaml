version: '3.8'

services:
  bot:
    # Указываем Portainer'у, что образ нужно собрать, а не скачивать
    build: .
    # Присваиваем имя собранному образу
    container_name: binance-bot-container
    restart: unless-stopped
    volumes:
      # Очень важно: сохраняем данные PostgreSQL в томе
      - postgres_data:/var/lib/postgresql/12/main
    # Переменные окружения будут добавлены вручную в UI Portainer
    environment:
      # Собираем полную строку подключения для Spring Boot.
      SPRING_DATASOURCE_URL: jdbc:postgresql://localhost:${DB_PORT}/${DB_NAME}
      # Отключаем интеграцию с Azure Key Vault, если она не используется.
      AZURE_KEYVAULT_ENABLED: false
      # Жестко прописываем DB_HOST
      DB_HOST: localhost
      # Для остальных переменных задаем пустые значения.
      # Docker Compose подставит вместо них значения из UI Portainer.
      DB_PORT:
      DB_USER:
      DB_PASSWORD:
      DB_NAME:
      TELEGRAM_ERROR_TOKEN:
      TELEGRAM_TOKEN:
      TELEGRAM_USERNAME:
      TELEGRAM_ERROR_USERNAME:
      BINANCE_API_SECRET:
      BINANCE_API_KEY:
      TRADING_BOT_ENABLED:

volumes:
  postgres_data: